name: Manual Build

on:
  workflow_dispatch:
    inputs:
      variant:
        description: 'Build variant'
        required: true
        default: 'standard'
        type: choice
        options:
          - minimal
          - standard
          - extended
      arch:
        description: 'Target architecture'
        required: true
        default: 'x86_64'
        type: choice
        options:
          - x86_64
          - arm64

jobs:
  build:
    name: Build
    uses: ./.github/workflows/build-workflow.yml
    with:
      variant: ${{ github.event.inputs.variant }}
      arch: ${{ github.event.inputs.arch }}
      upload_artifacts: true

  security:
    name: Security Scan
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v6

    - name: Run security scan
      run: |
        docker compose build
        docker compose run --rm kimigayo-build make security-scan
